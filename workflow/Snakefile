import sys
import peppy

singularity: "docker://continuumio/miniconda3"
configfile: "config/config.yaml"
pepfile: "config/pep.yaml"

SAMPLES = [x.sample_name for x in pep.samples]
SUBSAMPLE_TABLE = pep.subsample_table[0]

rule all:
    input:
        expand('results/copies/{s}.tsv',s=SAMPLES),
        expand("results/merged/{s}.bam.flagstat",s=SAMPLES),
        expand("results/snps/snps.tsv.gz",s=SAMPLES)

rule samtools_index:
    input:
        "{file}.bam"
    output:
        "{file}.bam.bai"
    params:
        "" # optional params string
    wrapper:
        "0.70.0/bio/samtools/index"

rule samtools_flagstat:
    input:
        "{file}.bam"
    output:
        "{file}.bam.flagstat"
    wrapper:
        "0.72.0/bio/samtools/flagstat"

include: "rules/trim.smk"
include: "rules/align-wgs.smk"
include: "rules/depth.smk"
include: "rules/snps.smk"
